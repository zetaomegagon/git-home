#!/usr/bin/env bash

emacs() {
    source "$HOME/.bashrc.d/12-emacs.rc"

    local is_term_flag
    local -a flags
    read -ra finput < <(printf -- "$*")
    flags=(
	"--display=${DISPLAY:-$WAYLAND_DISPLAY}"
	"--socket-name=$XDG_RUNTIME_DIR/emacs/server"
    )

    emacs-dead-p && emacsctl start

    if [[ $TERM =~ (tmux|xterm).* ]]; then
	flags+=("--tty")
    else
	flags+=("--reuse-frame")
    fi


    if [[ -z $finput ]]; then
	command emacsclient ${flags[@]}
    else
	command emacsclient ${flags[@]} ${finput[@]}
    fi
}

read -ra input < <(printf -- "$*")

emacs "${input[@]}"
