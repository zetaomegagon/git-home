#!/usr/bin/env bash

declare -a input=( $@ )

emacs() {
    source $HOME/.bashrc.d/12-emacs.rc

    local -a params
    local -a finput=( $@ )
    local -a flags=(
	--display="${DISPLAY:-$WAYLAND_DISPLAY}"
	--socket-name="$XDG_RUNTIME_DIR/emacs/server"
    )
    
    emacs-dead-p && emacsctl start

    # Need to compare $TERM to a terminal that
    # is not being actively used to excute the
    # script (i.e. from a shortcut)
    #
    # Would be good to find a common pattern
    # to use for the `--reuse-frame` case
    #
    # So far:
    # * gnome   - dumb
    # * stumpwm - linux
    # * lxqt    - qterminal
    if [[ $TERM =~ dumb|linux|qterminal ]]; then
        local is_term_flag+=" --reuse-frame"
    else
        local is_term_flag+=" --tty"
    fi

    if [[ -z $finput ]]; then
	command emacsclient ${flags[@]} $is_term_flag
    else
	command emacsclient ${flags[@]} $is_term_flag ${finput[@]}
    fi
}

emacs "${input[@]}"

